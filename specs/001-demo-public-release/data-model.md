# Data Model: Ready Demo for Public Release

**Source**: [spec.md](spec.md) Key Entities + Clarifications Session 2026-02-16
**Existing Data**: `cell_questions.json`, `wikipedia_articles.json`, `heatmap_cell_labels.json`

## Entity Schemas

### Domain

A knowledge area defining a rectangular region in embedding space with a
hierarchical parent/child relationship.

```
Domain {
  id:           string        # Slug: "physics", "quantum-physics", "all"
  name:         string        # Display: "Physics — General", "Quantum Physics"
  parent_id:    string | null # null for general domains and "All"
  level:        "all" | "general" | "sub"
  region: {
    x_min:      number        # Embedding space bounds (normalized 0–1)
    x_max:      number
    y_min:      number
    y_max:      number
  }
  grid_size:    number        # Cells per axis for this domain's heatmap
  question_ids: string[]      # Exactly 50 question IDs in this domain
}
```

**Identity**: Unique by `id` (slug).
**Relationships**: `parent_id` → Domain. Sub-domains are spatial subsets
of their parent. "All" has `parent_id: null` and `level: "all"`.
**Lifecycle**: Static — defined at build time, immutable at runtime.

**Validation rules**:
- `question_ids.length === 50` for every domain
- Sub-domain regions MUST be spatially contained within parent region
- "All" region spans the full embedding space (0–1 on both axes)
- Every `question_id` in a general domain MUST reference either a child
  sub-domain question or a unique general question

**Hierarchy** (from spec):

| Level | Domains | Count |
|-------|---------|-------|
| all | All (General) | 1 |
| general | Physics, Art History, Biology, Neuroscience, Mathematics | 5 |
| sub | Astrophysics, Quantum Physics, European Art History, Chinese Art History, Molecular and Cell Biology, Genetics, Cognitive Neuroscience, Computational Neuroscience, Neurobiology, Calculus, Linear Algebra, Number Theory, Probability and Statistics | 13 |
| **Total** | | **19** |

---

### Question

A verified quiz item with embedding coordinates and multi-domain membership.

```
Question {
  id:               string      # Stable hash (e.g., SHA-256 of question text)
  question_text:    string      # May contain LaTeX: "$x^2 + y^2 = r^2$"
  options: {
    A:              string
    B:              string
    C:              string
    D:              string
  }
  correct_answer:   "A" | "B" | "C" | "D"
  difficulty:       1 | 2 | 3 | 4 | 5   # 1=beginner, 5=expert
  x:                number      # Normalized embedding coordinate (0–1)
  y:                number      # Normalized embedding coordinate (0–1)
  source_article:   string      # Wikipedia article title for verification
  domain_ids:       string[]    # Domains containing this question (1+)
  concepts_tested:  string[]    # Topic descriptors for insight generation
}
```

**Identity**: Unique by `id` (hash of question text).
**Relationships**: `domain_ids` → Domain[] (many-to-many). A question
belongs to every domain whose region contains its (x, y) coordinates,
plus may be explicitly assigned to general domains.
**Lifecycle**: Static — generated by pipeline, immutable at runtime.

**Validation rules**:
- `domain_ids.length >= 1` (every question belongs to at least one domain)
- `correct_answer` MUST be one of the keys in `options`
- `difficulty` MUST be integer 1–5
- `x` and `y` MUST be in [0, 1]
- `source_article` MUST correspond to a real Wikipedia article (verified)
- Question text with LaTeX MUST use `$...$` delimiters (not `$$`)

**Scale**: ~750–800 unique questions total. Each domain presents exactly
50 (with overlap between parent and child domains).

---

### GridLabel

A unique human-readable label for one cell of a domain's heatmap grid.

```
GridLabel {
  domain_id:      string      # Which domain this grid belongs to
  gx:             number      # Grid x index (0-based)
  gy:             number      # Grid y index (0-based)
  center_x:       number      # Cell center in normalized coords
  center_y:       number      # Cell center in normalized coords
  label:          string      # Human-readable: "Quantum Mechanics"
  articles_in_cell: string[]  # Wikipedia article titles in this cell
}
```

**Identity**: Unique by `(domain_id, gx, gy)`.
**Relationships**: `domain_id` → Domain.
**Lifecycle**: Static — generated by pipeline per domain.

**Validation rules**:
- `label` MUST be unique within a domain (no two cells share a label)
- `gx` in [0, grid_size-1], `gy` in [0, grid_size-1]
- `articles_in_cell.length >= 1` (cells with zero articles should be
  excluded or labeled "Unexplored")

---

### UserResponse

A record of the visitor's answer to a specific question.

```
UserResponse {
  question_id:    string      # → Question.id
  domain_id:      string      # Domain active when question was answered
  selected:       "A" | "B" | "C" | "D"
  is_correct:     boolean
  timestamp:      number      # Unix epoch ms
}
```

**Identity**: Unique by `question_id` (a question is answered at most once).
**Relationships**: `question_id` → Question, `domain_id` → Domain.
**Lifecycle**: Created on answer submission. Persisted to localStorage.
Cleared only by explicit user reset (FR-021).

**State transitions**: None — responses are append-only and immutable
once recorded.

**Validation rules**:
- `selected` MUST be a valid option key for the referenced question
- `is_correct` MUST equal `(selected === question.correct_answer)`
- `question_id` MUST NOT already exist in the response set (no re-answering)

---

### KnowledgeEstimate

A per-cell confidence value for the active domain's heatmap.

```
KnowledgeEstimate {
  domain_id:      string      # Active domain
  gx:             number      # Grid cell x
  gy:             number      # Grid cell y
  value:          number      # Estimated knowledge (0.0–1.0)
  uncertainty:    number      # Estimation uncertainty (0.0–1.0)
  evidence_count: number      # Number of nearby responses influencing this cell
  state:          "unknown" | "uncertain" | "estimated"
}
```

**Identity**: Unique by `(domain_id, gx, gy)` — one per grid cell per domain.
**Relationships**: `domain_id` → Domain. Computed from UserResponse[].
**Lifecycle**: Recomputed on every new response submission and on domain
switch. Not persisted — derived from responses at runtime.

**State definitions** (per FR-017):
- `unknown`: `evidence_count === 0` — no nearby responses, high prior
  uncertainty. Default state before any questions answered.
- `uncertain`: `evidence_count >= 1` AND responses conflict (mix of
  correct and incorrect nearby). High posterior uncertainty.
- `estimated`: `evidence_count >= 1` AND responses are consistent.
  Confidence in the estimate is meaningful.

**Validation rules**:
- `value` in [0.0, 1.0]
- `uncertainty` in [0.0, 1.0]
- `evidence_count >= 0`
- `state` derivation MUST follow the definitions above

---

### SessionState

The top-level persisted state object (localStorage).

```
SessionState {
  schema_version:   string      # Semver: "1.0.0"
  created_at:       number      # Unix epoch ms
  updated_at:       number      # Unix epoch ms
  responses:        UserResponse[]
  active_domain_id: string | null
}
```

**Identity**: Singleton per browser origin.
**Lifecycle**: Created on first visit. Updated on every response or
domain switch. Serialized to localStorage on every mutation. Discarded
if `schema_version` doesn't match current app version (FR-007).

**Validation rules**:
- `schema_version` MUST match the current app's expected version
- On mismatch: discard entire state, start fresh, show notice
- On localStorage unavailable: operate in session-only mode (FR-007 edge case)

---

## Data Files (Pipeline Output → Frontend Input)

### Per-Domain Bundle (lazy-loaded)

Each domain produces a JSON file loaded on demand (FR-012 clarification):

```
data/domains/{domain_id}.json
{
  "domain":     Domain,           // Domain metadata + region + question_ids
  "questions":  Question[],       // The 50 questions for this domain
  "labels":     GridLabel[],      // Grid cell labels for heatmap
  "articles":   ArticleSummary[]  // Articles visible in this domain's region
}
```

Where `ArticleSummary` is a lightweight projection:

```
ArticleSummary {
  title:    string
  url:      string
  x:        number    # Normalized coordinate
  y:        number    # Normalized coordinate
}
```

### Domain Registry (loaded on startup)

```
data/domains/index.json
{
  "schema_version": "1.0.0",
  "domains": Domain[]   // All 19 domains (metadata only, no questions)
}
```

This small file (~5 KB) loads at startup to populate the domain menu
and minimap. Individual domain bundles are fetched on first access.

### File Size Estimates

| File | Estimated Size | When Loaded |
|------|---------------|-------------|
| `data/domains/index.json` | ~5 KB | Startup |
| `data/domains/{id}.json` (sub-domain) | ~100–200 KB | On domain select |
| `data/domains/{id}.json` (general) | ~200–400 KB | On domain select |
| `data/domains/all.json` | ~500 KB–1 MB | On "All" select |
| App code (JS + CSS) | ~200–500 KB | Startup |
| CDN (KaTeX + icons) | ~300 KB | Startup (cached) |
| **Initial load total** | **~500 KB–1 MB** | |

version: '3.8'

services:
  embeddings:
    build: .
    image: mapper-embeddings:latest
    container_name: mapper-embeddings
    volumes:
      # Mount questions.json so changes persist to host
      - ./questions.json:/app/questions.json
    environment:
      - TOKENIZERS_PARALLELISM=false
      - OMP_NUM_THREADS=1
      - MKL_NUM_THREADS=1
      # Uncomment and set if using OpenAI API
      # - OPENAI_API_KEY=${OPENAI_API_KEY}

    # Default command - override with docker-compose run
    command: python generate_embeddings.py --help

# Usage examples:
#
# Build the image:
#   docker-compose build
#
# Generate embeddings with UMAP (recommended):
#   docker-compose run --rm embeddings python generate_embeddings.py \
#     --questions-json questions.json --update-in-place --method umap
#
# Generate embeddings with PCA (faster):
#   docker-compose run --rm embeddings python generate_embeddings.py \
#     --questions-json questions.json --update-in-place --method pca
#
# Generate embeddings with t-SNE:
#   docker-compose run --rm embeddings python generate_embeddings.py \
#     --questions-json questions.json --update-in-place --method tsne
#
# Use OpenAI API (avoids local model download):
#   docker-compose run --rm embeddings python generate_embeddings.py \
#     --questions-json questions.json --update-in-place --use-openai
#
# Show help:
#   docker-compose run --rm embeddings python generate_embeddings.py --help
